<properties
  pagetitle="Mapping data flow - Sink Format and Connector Issue Common Solutions"
  description=""
  service=""
  resource=""
  ms.author="rakatuko"
  selfhelptype="Generic"
  supporttopicids="32633539"
  productpesids="15613"
  cloudenvironments="fairfax,public,usnat,ussec"
  disableclouds="blackforest,mooncake"
  articleid="9fcbd4a1-23d6-4133-8886-81dafe1baaa5"
  ownershipid="AzureData_DataFactory" />
# Mapping data flow - Sink Format and Connector Issue Common Solutions

### Common Solutions
Below are troubleshooting steps for some common scenarios with Dataflow sources:

#### Connection and Authentication Issues. ####

- SQL Server
    1. Master Key Error

        _**Cause**_: Master key does not exist in the database.

        _**Recommendation**_: Create a master key in the SQL server.

    2. Public access Error 

        _**Cause**_: Public access for azure services are not allowed in the firewall section of SQL Server in the Azure portal

        _**Recommendation**_: Make sure public access to azure services is enabled in the Azure portal

- **Storage Accounts**
    1. Storage account is in a private network

        _**Recommendations**_:

        - Create an Azure Integration Runtime (IR) within Azure Data Factory Managed Virtual Network (VNET) and leverage ADLS gen2 private endpoint. Refer to the article [here](https://docs.microsoft.com/azure/data-factory/managed-virtual-network-private-endpoint) for instructions.
            
        - Enable 'Allow Trusted Servicesâ€¦' in the storage account and use Azure IR. Refer to the article [here](https://techcommunity.microsoft.com/t5/azure-data-factory/data-factory-is-now-a-trusted-service-in-azure-storage-and-azure/ba-p/964993) to see how to do this.

        - Create Azure IR in a specific region different from the Storage account and whitelist Azure IR IPs for that region in the storage account. It is recommended to use a service tag for the specific region, because the IP ranges may change. Refer to the article [here](https://docs.microsoft.com/azure/data-factory/azure-integration-runtime-ip-addresses) for IP address and setup information.
       
    2. 403 Forbidden

        _**Cause**_: 403 Forbidden since the container/folder level permissions are not set.

        _**Recommendation**_: Make sure the right permissions are set for the authentication method used in the linked service for the container/folder that will be accessed using DataFlow.

#### **Sink Connector Issues**

1. Error Row handling not executing pre/post SQL or Truncate table writes to Sink
    
    _**Recommendation**_: Debug preview doesn't write to Sinks and therefore, error row handling won't be reflected in the preview. For testing, this use Debug runs instead

2. New columns are not being created in the sink even when schema drift is on.

    _**Cause**_: This is by design and isn't currently supported in Data Flow.
    
    _**Recommendation**_: Make sure the schema of the sink table contains the column that is required unless the sink will be creating a new table

3. Performance issues while writing data in the sink
    
    _**Cause**_: Single partition is chosen in the optimize tab of the sink.
    
    **_Recommendations_**:
    1. Use current partitioning instead
    2. If you want to choose custom partitioning, refer to the performance tuning guide [here](https://docs.microsoft.com/azure/data-factory/concepts-data-flow-performance)

### **FAQ**

**My connection to Azure Synapse Analytics (Formerly Azure Data Warehouse) works when I test connectivity, but it fails when attempting to write data with a permissions error. What are the permissions required?**

To use PolyBase, the user loading data into SQL Data Warehouse must have the `CONTROL` permission on the target database. For more information, see the connector documentation.

## **Recommended Documents**

* Troubleshooting for common error codes and messages can be found [here](https://docs.microsoft.com/azure/data-factory/data-flow-troubleshoot-guide)
* General documentation for configuring dataflow sources [here](https://docs.microsoft.com/azure/data-factory/data-flow-source)
* To request a new feature, see [Feature Request](https://feedback.azure.com/forums/270578-azure-data-factory).
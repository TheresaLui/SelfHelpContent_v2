<properties
  pagetitle="This is the title of the article. It is not displayed in the portal but is a required part of every article."
  description=""
  service="microsoft.keyvault"
  resource="managedhsms"
  ms.author="qinx"
  selfhelptype="Generic"
  supporttopicids="32736894"
  productpesids="17075"
  cloudenvironments="public"
  disableclouds="blackforest,fairfax,mooncake,usnat,ussec"
  articleid="e2f2ac52-6fd7-4121-b19a-bf6ca5128eb2"
  ownershipid="AzureKeyVault_MHSM" />
# This is the title of the article. It is not displayed in the portal but is a required part of every article.

An application does not have sufficient permissions to perform operations on Managed HSM.

## **Recommended Steps**

1. Make sure this service principal is the one used in your application. The CLI command below can show the information about your application's service principal id.
    ```
    az ad sp show --id [your application id] --query "{servicePrincipalId: objectId}" -o table
    ```

2. If this is a trusted application, ask an administrator ( a user in Managed HSM builtin roles "Managed HSM Administrator" ) of Managed HSM to assign a appropriate role to service principal retrieved above.
 
    For example when using Azure CLI, run this command as the administrator of the Managed HSM:<br>
    - To give key encrypt/decrypt operations to the application:
        ```
        az keyvault role assignment create --assignee "[service principal id]" --role "Managed HSM Crypto User" --scope "/" --hsm-name [PoolName]
        ```

    - To give key additional key create/delete operations to the application: 

        ```
        az keyvault role assignment create --assignee "[service principal id]" --role "Managed HSM Crypto Officer" --scope "/" --hsm-name [PoolName]
        ```

    Role "Managed HSM Administrator" has all the permissions.

    To list all the administorators of this Managed HSM, run Azure CLI command:
    ```
    az keyvault role assignment list --hsm-name [PoolName] --role "Managed HSM Administrator"
    ```

See links below for details of different builtin roles' permissions in Managed HSM.

## **Recommended Documents**

Refer to the following documents to setup permissions for your application.<br>

* [Managed HSM local RBAC built-in roles](https://docs.microsoft.com/azure/key-vault/managed-hsm/built-in-roles)
* [Managed HSM access control](https://docs.microsoft.com/azure/key-vault/managed-hsm/access-control)
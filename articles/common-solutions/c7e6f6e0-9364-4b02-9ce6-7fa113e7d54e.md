<properties
  pagetitle="Issues with Azure Monitor Private Link Scopes"
  service=""
  resource=""
  ms.author="noakuper"
  selfhelptype="Generic"
  supporttopicids="32745441"
  productpesids="15725"
  cloudenvironments="public, fairfax, mooncake, blackforest, ussec, usnat"
  disableclouds=""
  articleid="c7e6f6e0-9364-4b02-9ce6-7fa113e7d54e"
  ownershipid="AzureMonitoring_LogAnalytics" />
# Issues with Azure Monitor Private Link Scopes

Most issues related to Azure Monitor Private Links scopes are related to DNS configurations, limits or AMPLS settings. The steps below list common issue you may be facing
For more details see [Use Azure Private Link to securely connect networks to Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/platform/private-link-security).

## **Recommended Steps**

1. Hub-spoke networks, or any other topology of peered networks, can setup a Private Endpoint connecting the hub (main) VNet and an AMPLS, instead of setting up Private Endpoints on each VNet. This makes sense especially if the Azure Monitor resources used by these networks are shared. However, if you'd like to allow each VNet to access a separate set of monitoring resources, create a Private Link to a dedicated AMPLS for each network.
2. Note that VNets that connect to different AMPLSs may override each other's endpoint mapping if a shared DNS is used. This is because some of these endpoints are global (meaning they have the same FQDN regardless of the target resource), such as Application Insights ingestion. To avoid that, use a different DNS for each AMPLS you map your VNets to.
3. Due to the global nature of some Azure Monitor endpoints (as explain in #2), it's not posbbile for a VNet to access some monitoring resources (Workspaces/Application Insights components) over Private Link, and other over a public connection. Once you connect a VNet to an AMPLS through a Private Endpoint, *all monitoring resources must be connected to an AMPLS. Public access to these resources will not be possible from this VNet.
4. The AMPLS has several limitations - 
    * A VNet can only connect to 1 AMPLS object
    * An AMPLS object can connect to 10 Private Endpoints at most.
    * An AMPLS object can connect to 50 Azure Monitor resources at most.
    * An Azure Monitor resource (Workspace or Application Insights component) can be connected to 5 AMPLSs at most.
5. When creating a Private Endpoint, you can choose to integrate with private DNS zone, which will automatically create a new Private DNS Zone. If you chose not to do that and prefer to manage DNS records manually, first complete setting up your Private Link - including this Private Endpoint and the AMPLS configuration. Then, configure your DNS according to the instructions in [Azure Private Endpoint DNS configuration](https://docs.microsoft.com/azure/private-link/private-endpoint-dns). Make sure not to create empty records as preparation for your Private Link setup. The DNS records you create can override existing settings and impact your connectivity with Azure Monitor.

## **Recommended Documents**

* [Use Azure Private Link to securely connect networks to Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/platform/private-link-security)
* [Using customer-managed storage accounts in Azure Monitor Log Analytics](https://docs.microsoft.com/azure/azure-monitor/platform/private-storage)
* [Azure Private Endpoint DNS configuration](https://docs.microsoft.com/azure/private-link/private-endpoint-dns)
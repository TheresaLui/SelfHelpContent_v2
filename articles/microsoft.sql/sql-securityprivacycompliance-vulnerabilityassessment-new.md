<properties
	pageTitle="security, privacy and compliance/vulnerability assessment"
	description="security, privacy and compliance/vulnerability assessment"
	service="microsoft.sql"
	resource="servers"
	authors="emlisa"
    ms.author="emlisa"
	displayOrder=""
	selfHelpType="generic"
	supportTopicIds="32630461"
	resourceTags=""
	productPesIds="13491"
	cloudEnvironments="public,blackForest,fairfax,mooncake, usnat, ussec"
	articleId="46850d41-7e4a-476a-ae9a-959f10bd4e30"
	ownershipId="AzureData_AzureSQLDB_Security"
/>

# Vulnerability Assessment

## **Recommended Documents**

* [Vulnerability assessment](https://docs.microsoft.com/azure/sql-database/sql-vulnerability-assessment?WT.mc_id=pid:13491:sid:32630461/)<br>
* [Advanced Threat Protection](https://docs.microsoft.com/azure/sql-database/sql-advanced-threat-protection?WT.mc_id=pid:13491:sid:32630461/)


## **Vulnerability assessment Issues and recommended steps**

### **Recommended Steps**

- In cases Azure SQL Server has moved from another subscription or the subscription moved to another tenant - Vulnerability Assessment may fail to scan your databases or to load scan results. To mitigate, re-save the vulnerability assessment settings.
- The permissions listed the [doc](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#sql-security-manager)  are required to run vulnerability assessment scans.
- If the storage account is behind firewall please follow the instructions [here](https://docs.microsoft.com/azure/azure-sql/database/sql-database-vulnerability-assessment-storage)

### **Issues and Solution **

#### Fail to save vulnerability assessment settings
- **Storage mismatch**
The storage account in which vulnerability assessment scan results are saved, should meet the following requirements: 
Type - StorageV2 (general purpose V2) or Storage (general purpose V1)
Performance  - Standard (only)
Region - The storage must be in the same region as the Azure SQL Serve.
If any of these requirements not met, saving vulnerability assessment settings will fail.

- **Insufficient permissions**
The following permissions are required for these operations: 
	- https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#sql-security-manager
	- One of the role that allowed to set a new role assignment (owner or user access admin for storage account)

#### My storage account is not visible for selection (vulnerability assessment settings)
The storage account may not appear in the storage picker for several reasons:
- The storage account you are looking for is not in the selected subscription .
- The storage account you are looking for is not in the same region as the Azure SQL Server.
- You do not have Microsoft.Storage/storageAccounts/read permissions on the storage account.

#### Fail to open email link for scan result / can not view scan results
- **Insufficient permissions**
The following permissions are required for these operations: 
	- Microsoft.Storage/storageAccounts/read and Microsoft.Storage/storageAccounts/listKeys/action

- **Browser issue**
Firefox browser does not support scan results view. We recommend customers use Chrome or Edge.

#### Set a Baseline doesn't impact consecutive scans
If you add a rule to a Baseline and the rule still fails in consecutive scans- 
The UI is limited to showing top 100 results for a single rule.
In the rare cases where a rule returns more than 100 results, only these 100 results will be added to the Baseline when you add the rule to the Baseline.
Therefore in consecutive scans, the rule will show as failing again and the next 100 results will appear in the set baseline view.
To mitigate and set all the results in one time use PowerShell commands as shown [here](https://docs.microsoft.com/azure/azure-sql/database/sql-vulnerability-assessment).